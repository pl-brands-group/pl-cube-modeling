cubes:
  - name: dws_po_cost_summary
    sql_table: Jushuitan.dws_po_cost_summary
    data_source: default

    joins: []

    dimensions:
      - name: po_id
        sql: po_id
        type: number
        primary_key: true

      - name: status
        sql: status
        type: string

      - name: item_type
        sql: item_type
        type: string

      - name: labels
        sql: labels
        type: string

      - name: is_finished
        sql: is_finished
        type: string

      - name: seller
        sql: seller
        type: string

      - name: seller_shorted
        sql: seller_shorted
        type: string

      - name: po_date
        sql: po_date
        type: time

    measures:
      - name: count
        type: count

      - name: sum_qty
        sql: sum_qty
        type: sum

      - name: sum_inqty
        sql: sum_inqty
        type: sum

      - name: sum_not_inqty
        sql: sum_not_inqty
        type: sum

      - name: completion_rate
        sql: completion_rate
        type: avg

      - name: sum_price
        sql: sum_price
        type: sum

      - name: po_unreceived_delay_cost
        sql: po_unreceived_delay_cost
        type: sum

      - name: po_received_delay_cost
        sql: po_received_delay_cost
        type: sum

      - name: total_delay_cost
        sql: total_delay_cost
        type: sum

    segments:
      - name: finished_products_segment
        sql: |
          {CUBE}.item_type = '成品'
          AND DATE({CUBE}.po_date) > DATE '2025-02-28'
          AND {CUBE}.status IN ('Confirmed', 'Finished')
          AND {CUBE}.labels NOT IN ('返修单', '返修退货', '代售')

    pre_aggregations:
      # Pre-aggregation definitions go here.
      # Learn more in the documentation: https://cube.dev/docs/caching/pre-aggregations/getting-started

